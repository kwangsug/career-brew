<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì»¤ë¦¬ì–´ ë¸Œë£¨: ë“€ì–¼ ë§ˆìŠ¤í„° (ë°¸ëŸ°ìŠ¤ ìˆ˜ì •íŒ)</title>
    <style>
        /* ê¸°ë³¸ ì„¤ì • */
        body { font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; text-align: center; background: #f4e4bc; color: #333; margin: 0; padding: 20px; user-select: none; -webkit-user-select: none; box-sizing: border-box; touch-action: manipulation; }
        * { box-sizing: border-box; }

        #game-container { max-width: 450px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative; overflow: hidden; }
        
        canvas { border-radius: 15px; background: #d2b48c; cursor: pointer; width: 100%; touch-action: none; display: block; margin-bottom: 15px; -webkit-tap-highlight-color: transparent; }
        
        #ui { margin-bottom: 15px; padding: 15px; background: #faf3e0; border-radius: 15px; border: 1px solid #f0e0c0; }
        .stat-line { display: flex; justify-content: space-between; font-weight: bold; font-size: 15px; align-items: center; margin-bottom: 8px; color: #3e2723; }
        .main-beans { font-size: 28px; color: #8b4513; margin: 15px 0; font-weight: 900; word-break: keep-all; letter-spacing: -0.5px; line-height: 1.2; }
        
        .badge { padding: 6px 10px; border-radius: 15px; min-width: 70px; display: inline-block; text-align: center; border: 2px solid transparent; font-weight: 800; font-size: 13px; }
        .badge-click { background: #ffe0b2; color: #e65100; border-color: #ffb74d; }
        .badge-bps { background: #e0f2f1; color: #00695c; border-color: #4db6ac; }

        .store-header { text-align: left; margin: 25px 0 10px 0; font-size: 18px; font-weight: 800; color: #3e2723; border-bottom: 3px solid #eee; padding-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }

        #upgrades { display: flex; flex-direction: column; gap: 10px; height: 380px; overflow-y: auto; padding-right: 5px; padding-bottom: 20px; }
        #upgrades::-webkit-scrollbar { width: 6px; }
        #upgrades::-webkit-scrollbar-thumb { background: #8d6e63; border-radius: 10px; }
        #upgrades::-webkit-scrollbar-track { background: #efebe9; }

        button { 
            background: #fff; border: 2px solid #eee; padding: 12px 15px 12px 20px; 
            cursor: pointer; border-radius: 12px; display: flex; justify-content: space-between; 
            transition: 0.1s; align-items: center; text-align: left; position: relative; overflow: visible; 
            min-height: 80px; height: auto; box-shadow: 0 2px 0 #e0e0e0; width: 100%;
        }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 0 #ccc; }
        button:active:not(:disabled) { transform: translateY(0); box-shadow: 0 0 0; }
        button:disabled { background: #f9f9f9; color: #bbb; cursor: not-allowed; opacity: 0.7; border-color: #f0f0f0; box-shadow: none; }
        
        .btn-click { border-left: 8px solid #ff9800; }
        .btn-bps { border-left: 8px solid #009688; }

        .item-info { display: flex; flex-direction: column; gap: 4px; z-index: 2; flex: 1; }
        .item-name { font-weight: 900; font-size: 16px; color: #222; letter-spacing: -0.5px; line-height: 1.2; }
        .item-cost { font-size: 12px; color: #5d4037; font-weight: 700; background: rgba(139, 69, 19, 0.08); padding: 2px 6px; border-radius: 4px; display: inline-block; width: fit-content; margin-top: 2px; }
        
        .item-right { text-align: right; min-width: 100px; display: flex; flex-direction: column; align-items: flex-end;}
        .item-effect { font-weight: 900; font-size: 14px; z-index: 2; text-shadow: 1px 1px 0 #fff; line-height: 1.2; word-break: break-all;}
        .item-lvl { font-size: 12px; color: #888; font-weight: bold; margin-bottom: 3px; }
        
        .rank-info { font-size: 14px; color: #4e342e; margin-top: 15px; padding: 15px; border-top: 2px dashed #bbb; cursor: pointer; background: #efebe9; border-radius: 10px; font-weight: bold; }
        
        #ranking-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:2000; align-items:center; justify-content:center; }
        .modal-content { background:white; width:90%; max-width:380px; padding:25px; border-radius:20px; text-align:center; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<div id="game-container">
    <h1>â˜• ì»¤ë¦¬ì–´ ë¸Œë£¨: ë“€ì–¼ ë§ˆìŠ¤í„°</h1>
    <div id="ui">
        <div class="stat-line">
            <span>ì§ê¸‰: <span id="level" style="color:#d2691e; font-size:18px;">ì•Œë°”ìƒ</span></span>
        </div>
        
        <div class="stat-line">
            <span>ğŸ‘† í´ë¦­ë‹¹: <span id="click-power" class="badge badge-click">1</span></span>
            <span>âš™ï¸ ì´ˆë‹¹: <span id="bps" class="badge badge-bps">0</span></span>
        </div>

        <div class="main-beans"><span id="beans">0</span> ğŸ«˜</div>
        <div style="font-size: 13px; color: #5d4037; font-weight: bold; margin-top:5px;">ì†ìœ¼ë¡œ ë³¶ì€ ì½©: <span id="manualTotal">0</span></div>
    </div>

    <canvas id="game" width="400" height="300"></canvas>

    <div class="store-header">
        <span>ğŸ›’ ìƒì  (Store)</span>
        <span style="font-size:13px; font-weight:bold; color:#795548;">ì•„ì´í…œì„ êµ¬ë§¤í•˜ì„¸ìš”!</span>
    </div>
    <div id="upgrades"></div>
    
    <div class="rank-info" onclick="showRanking()">
        ğŸ“ <b>ìš°ì£¼ í†µí•© ë­í‚¹ í™•ì¸í•˜ê¸°</b> (Click)<br>
        <span style="font-size:12px; font-weight:normal; color:#5d4037">ë‚˜ì˜ ì‹¤ì‹œê°„ ìˆœìœ„ëŠ”?</span> 
        <span id="my-rank-text" style="color:#d84315; font-weight:900; font-size:16px;">ì§‘ê³„ ì¤‘...</span>
    </div>
</div>

<div id="ranking-modal">
    <div class="modal-content">
        <h2 style="color:#3e2723; margin-top:0; border-bottom:2px solid #eee; padding-bottom:10px;">ğŸ† ì‹¤ì‹œê°„ ë­í‚¹</h2>
        <div id="ranking-list"></div>
        <button onclick="closeRanking()" style="width:100%; justify-content:center; margin-top:20px; height:50px; font-size:18px; font-weight:bold; background:#3e2723; color:white; border:none; border-radius:10px;">ë‹«ê¸°</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    let gameState = {
        beans: 0,
        baseBps: 0,
        baseClick: 1,
        manualTotal: 0,
        feverGauge: 0,
        isFever: false,
        lastTime: Date.now(),
        levels: ['ì•Œë°”ìƒ', 'ì£¼ì„', 'ëŒ€ë¦¬', 'ê³¼ì¥', 'ì°¨ì¥', 'ë¶€ì¥', 'ì´ì‚¬', 'CEO', 'ì»¤í”¼ ì¬ë²Œ', 'ì›ë‘ ì¥ê´€', 'ì§€êµ¬ ëŒ€í†µë ¹', 'íƒœì–‘ê³„ ê´€ë¦¬ì', 'ì€í•˜ê³„ ì§€ë°°ì', 'ìš°ì£¼ì˜ ì£¼ì¸', 'ì»¤í”¼ì˜ ì‹ ']
    };

    // ë°¸ëŸ°ìŠ¤ íŒ¨ì¹˜: ì•„ì´í…œ ê°„ ê°€ê²© ê²©ì°¨(Price Gap)ë¥¼ ëŒ€í­ ì¦ê°€
    const items = [
        // [ì´ˆë°˜] ë…¸ë™ì˜ ì‹œì‘
        { name: 'ğŸ§¤ ê³ ë¬´ ì¥ê°‘', type: 'click', basePrice: 30, val: 1, owned: 0 },
        { name: 'â˜• ëª¨ì¹´í¬íŠ¸', type: 'bps', basePrice: 1000, val: 5, owned: 0 }, // ì²« ìë™í™” í—ˆë“¤ ìƒìŠ¹
        
        // [ì¤‘ë°˜] ì¥ë¹„ ì—…ê¸€ (ì—¬ê¸°ì„œë¶€í„° ê²©ì°¨ ë°œìƒ)
        { name: 'ğŸ”¨ ì›ë‘ ë§ì¹˜', type: 'click', basePrice: 15000, val: 50, owned: 0 }, // 1.5ë§Œ
        { name: 'ğŸ”Œ ê°€ì •ìš© ë¨¸ì‹ ', type: 'bps', basePrice: 80000, val: 200, owned: 0 }, // 8ë§Œ
        
        // [ì „ë¬¸ê°€] ì‚¬ì—… ì‹œì‘
        { name: 'ğŸ“ ë°”ë¦¬ìŠ¤íƒ€ 1ê¸‰', type: 'click', basePrice: 1500000, val: 2500, owned: 0 }, // 150ë§Œ
        { name: 'ğŸª í”„ëœì°¨ì´ì¦ˆ', type: 'bps', basePrice: 5000000, val: 6000, owned: 0 }, // 500ë§Œ
        
        // [ê¸°ì—…] ëŒ€ëŸ‰ ìƒì‚°
        { name: 'âš¡ ì „ê¸° ì¥ê°‘', type: 'click', basePrice: 80000000, val: 50000, owned: 0 }, // 8000ë§Œ
        { name: 'ğŸ­ ìŠ¤ë§ˆíŠ¸ íŒ©í† ë¦¬', type: 'bps', basePrice: 300000000, val: 150000, owned: 0 }, // 3ì–µ
        
        // [ê¸€ë¡œë²Œ] êµ­ê°€ê¸‰ (ì–µ ë‹¨ìœ„ ëŒíŒŒ)
        { name: 'ğŸ¦¾ ì‚¬ì´ë³´ê·¸ íŒ”', type: 'click', basePrice: 2000000000, val: 800000, owned: 0 }, // 20ì–µ
        { name: 'ğŸš¢ ì›ë‘ ë¬´ì—­ì„ ', type: 'bps', basePrice: 15000000000, val: 4000000, owned: 0 }, // 150ì–µ
        
        // [í•˜ì´í…Œí¬] ì¡° ë‹¨ìœ„ ì§„ì…
        { name: 'ğŸ§¬ ëŒì—°ë³€ì´ ì†', type: 'click', basePrice: 800000000000, val: 30000000, owned: 0 }, // 8000ì–µ
        { name: 'ğŸ™ï¸ ì»¤í”¼ ì œêµ­ ë³¸ì‚¬', type: 'bps', basePrice: 5000000000000, val: 150000000, owned: 0 }, // 5ì¡°

        // [í–‰ì„±ê¸‰] ê²½ ë‹¨ìœ„ ì¤€ë¹„
        { name: 'ğŸ§  ë‡ŒíŒŒ ë¡œìŠ¤íŒ…', type: 'click', basePrice: 200000000000000, val: 2000000000, owned: 0 }, // 200ì¡°
        { name: 'ğŸ¤– AI êµ°ë‹¨', type: 'bps', basePrice: 1500000000000000, val: 8000000000, owned: 0 }, // 1500ì¡°

        // [ìš°ì£¼ê¸‰] ê²½ ë‹¨ìœ„
        { name: 'ğŸŒ‹ ë§ˆê·¸ë§ˆ í„°ì¹˜', type: 'click', basePrice: 4e16, val: 1e11, owned: 0 }, // 4ê²½
        { name: 'ğŸŒ§ï¸ ì¸ê³µê°•ìš° ìœ„ì„±', type: 'bps', basePrice: 3e17, val: 5e11, owned: 0 }, // 30ê²½

        // [ì„±ê°„ê¸‰] í•´ ë‹¨ìœ„
        { name: 'â˜„ï¸ ìœ ì„±ìš° íƒ€ê²©', type: 'click', basePrice: 2e18, val: 2e12, owned: 0 }, // 2í•´
        { name: 'ğŸŒ• ë‹¬í‘œë©´ ê±´ì¡°ì¥', type: 'bps', basePrice: 1e19, val: 8e12, owned: 0 }, // 10í•´

        // [ì€í•˜ê¸‰] ì ë‹¨ìœ„
        { name: 'â˜€ï¸ íƒœì–‘ê¶Œ í€ì¹˜', type: 'click', basePrice: 5e20, val: 3e13, owned: 0 }, 
        { name: 'â˜¢ï¸ í•µìœµí•© ë³´ì¼ëŸ¬', type: 'bps', basePrice: 4e21, val: 2e14, owned: 0 },

        // [ì°¨ì›ê¸‰] ì–‘ ë‹¨ìœ„
        { name: 'ğŸŒ€ ì›Œí”„ í´ë¦­', type: 'click', basePrice: 3e23, val: 1e15, owned: 0 }, 
        { name: 'ğŸ•³ï¸ ë¸”ë™í™€ ë¶„ì‡„ê¸°', type: 'bps', basePrice: 2e24, val: 8e15, owned: 0 },

        // [ì‹ ê¸‰] êµ¬/ê°„ ë‹¨ìœ„
        { name: 'âœ¨ í˜„ì‹¤ ì¡°ì‘', type: 'click', basePrice: 1e26, val: 5e16, owned: 0 }, 
        { name: 'ğŸ’¥ ë¹…ë±… ë¡œìŠ¤í„°', type: 'bps', basePrice: 8e27, val: 3e17, owned: 0 }
    ];

    const competitors = [
        { name: "ì€í•˜ê³„ ì»¤í”¼ ì—°í•©", bps: 5e15 },
        { name: "ì¼ë¡  ë¨¸ìŠ¤í¬", bps: 3e9 }, 
        { name: "ì—­ì‚¼ë™ ì¹´ëˆ„ ì¥ì¸", bps: 2000 },
        { name: "ì˜†ì§‘ ìŠ¤íƒ€ë²…ìŠ¤", bps: 5000 }
    ];

    function formatNum(num) {
        num = Math.floor(num); 
        if (num < 10000) return num.toLocaleString();

        const units = ["", "ë§Œ", "ì–µ", "ì¡°", "ê²½", "í•´", "ì", "ì–‘", "êµ¬", "ê°„", "ì •", "ì¬", "ê·¹"];
        let unitIndex = Math.floor(Math.log10(num) / 4);
        if (unitIndex >= units.length) unitIndex = units.length - 1;

        const majorUnitVal = Math.pow(10000, unitIndex);
        const majorNum = Math.floor(num / majorUnitVal);
        const minorNum = Math.floor((num % majorUnitVal) / (majorUnitVal / 10000));

        let result = `${majorNum}${units[unitIndex]}`;
        if (minorNum > 0 && unitIndex > 0) {
            result += ` ${minorNum}${units[unitIndex - 1]}`;
        }
        return result;
    }

    let particles = [];

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        if (gameState.baseBps > 1e8 || gameState.baseClick > 1e8) {
            ctx.fillStyle = '#0d1b2a'; 
            ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = '#fff';
            for(let i=0; i<20; i++) {
                ctx.globalAlpha = Math.random();
                ctx.fillRect(Math.random()*400, Math.random()*300, 2, 2);
            }
            ctx.globalAlpha = 1.0;
        } else {
            ctx.fillStyle = gameState.isFever ? '#fff9c4' : '#d2b48c';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        ctx.save();
        if(gameState.isFever) {
            ctx.shadowBlur = 30;
            ctx.shadowColor = "#ffeb3b";
        }
        ctx.fillStyle = gameState.isFever ? '#ff5722' : '#6d4c41';
        ctx.beginPath();
        ctx.roundRect(50, 80, 300, 140, 25);
        ctx.fill();
        ctx.restore();

        particles.forEach((p, i) => {
            ctx.fillStyle = (gameState.baseBps > 1e8) ? `rgba(255, 255, 255, ${p.life})` : `rgba(62, 39, 35, ${p.life})`;
            ctx.beginPath(); ctx.arc(p.x, p.y, 7, 0, Math.PI*2); ctx.fill();
            p.x += p.vx; p.y += p.vy; p.vy += 0.5; p.life -= 0.03;
            if (p.life <= 0) particles.splice(i, 1);
        });

        ctx.fillStyle = 'rgba(255,255,255,0.6)'; ctx.fillRect(50, 260, 300, 14);
        ctx.fillStyle = gameState.isFever ? '#d50000' : '#fb8c00';
        ctx.fillRect(50, 260, 300 * (gameState.feverGauge/100), 14);
        
        ctx.fillStyle = (gameState.baseBps > 1e8) ? '#fff' : '#3e2723'; 
        ctx.font = '900 16px Arial';
        ctx.fillText(gameState.isFever ? "ğŸ”¥ FEVER MODE (x10) ğŸ”¥" : "CLICK TO ROAST", 110, 250);
    }

    function handleInput(e) {
        e.preventDefault(); 
        const rect = canvas.getBoundingClientRect();
        const points = e.changedTouches ? e.changedTouches : [{clientX: e.clientX, clientY: e.clientY}];

        for (let i = 0; i < points.length; i++) {
            const p = points[i];
            const x = (p.clientX - rect.left) * (canvas.width / rect.width);
            const y = (p.clientY - rect.top) * (canvas.height / rect.height);

            if (x > 20 && x < 380 && y > 50 && y < 250) {
                const multiplier = gameState.isFever ? 10 : 1;
                const clickGain = gameState.baseClick * multiplier;
                
                gameState.beans += clickGain;
                gameState.manualTotal += clickGain;
                
                if (!gameState.isFever) {
                    gameState.feverGauge = Math.min(100, gameState.feverGauge + 5);
                    if (gameState.feverGauge >= 100) startFever();
                }

                for(let j=0; j<6; j++) {
                    particles.push({x: x, y: y, vx:(Math.random()-0.5)*15, vy:(Math.random()-0.5)*15-5, life:1});
                }
            }
        }
    }

    canvas.addEventListener('touchstart', handleInput, {passive: false});
    canvas.addEventListener('mousedown', handleInput);

    function startFever() {
        gameState.isFever = true;
        const fInter = setInterval(() => {
            gameState.feverGauge -= 1.0;
            if (gameState.feverGauge <= 0) {
                gameState.isFever = false;
                gameState.feverGauge = 0;
                clearInterval(fInter);
            }
        }, 50);
    }

    function updateStore() {
        const upgradesDiv = document.getElementById('upgrades');
        upgradesDiv.innerHTML = '';
        items.forEach((item) => {
            const price = Math.floor(item.basePrice * Math.pow(1.15, item.owned));
            const btn = document.createElement('button');
            
            const isClickItem = item.type === 'click';
            btn.className = isClickItem ? 'btn-click' : 'btn-bps';
            btn.disabled = gameState.beans < price;
            
            const effectColor = isClickItem ? '#e65100' : '#00695c';
            const typeIcon = isClickItem ? 'ğŸ‘†' : 'âš™ï¸';
            const unitText = isClickItem ? '/í´ë¦­' : '/ì´ˆ';

            btn.innerHTML = `
                <div class="item-info">
                    <span class="item-name">${typeIcon} ${item.name}</span>
                    <span class="item-cost">ë¹„ìš©: ${formatNum(price)} ğŸ«˜</span>
                </div>
                <div class="item-right">
                    <div class="item-lvl">Lv. ${item.owned}</div>
                    <div class="item-effect" style="color:${effectColor}">+${formatNum(item.val)}${unitText}</div>
                </div>
            `;
            
            btn.onclick = (e) => {
                if (gameState.beans >= price) {
                    gameState.beans -= price;
                    item.owned++;
                    if (item.type === 'click') {
                        gameState.baseClick += item.val;
                    } else {
                        gameState.baseBps += item.val;
                    }
                    updateStore(); 
                }
            };
            upgradesDiv.appendChild(btn);
        });
    }

    function showRanking() {
        const modal = document.getElementById('ranking-modal');
        const list = document.getElementById('ranking-list');
        const currentBps = gameState.baseBps * (gameState.isFever ? 10 : 1);
        
        const allRanks = [...competitors, { name: "ë‚˜ (í”Œë ˆì´ì–´)", bps: currentBps }]
            .sort((a, b) => b.bps - a.bps);

        list.innerHTML = allRanks.map((p, i) => `
            <div class="rank-item ${p.name === "ë‚˜ (í”Œë ˆì´ì–´)" ? 'rank-me' : ''}">
                <span>${i+1}ìœ„. ${p.name}</span>
                <span>${formatNum(p.bps)} BPS</span>
            </div>
        `).join('');
        modal.style.display = 'flex';
    }

    function closeRanking() { document.getElementById('ranking-modal').style.display = 'none'; }

    function gameLoop() {
        const now = Date.now();
        const delta = (now - gameState.lastTime) / 1000;
        gameState.lastTime = now;

        const multiplier = gameState.isFever ? 10 : 1;
        const currentBps = gameState.baseBps * multiplier;
        const currentClick = gameState.baseClick * multiplier;
        
        gameState.beans += currentBps * delta;
        
        document.getElementById('beans').textContent = formatNum(gameState.beans);
        
        const bpsBadge = document.getElementById('bps');
        const clickBadge = document.getElementById('click-power');
        
        bpsBadge.textContent = formatNum(currentBps);
        clickBadge.textContent = formatNum(currentClick);

        if(gameState.isFever) {
            const shake = `scale(${1 + Math.sin(now/50)*0.1})`;
            bpsBadge.parentElement.style.color = '#d50000';
            bpsBadge.style.transform = shake;
            clickBadge.style.transform = shake;
        } else {
            bpsBadge.parentElement.style.color = '#5d4037';
            bpsBadge.style.transform = 'scale(1)';
            clickBadge.style.transform = 'scale(1)';
        }

        document.getElementById('manualTotal').textContent = formatNum(gameState.manualTotal);
        
        const score = Math.max(gameState.baseBps, gameState.baseClick);
        if (score > 0) {
            const levelIndex = Math.min(Math.floor(Math.log10(score)), gameState.levels.length - 1);
            if (levelIndex >= 0) document.getElementById('level').textContent = gameState.levels[levelIndex];
        }

        const myRank = [...competitors, {bps: currentBps}].sort((a,b)=>b.bps-a.bps).findIndex(p => p.bps === currentBps) + 1;
        document.getElementById('my-rank-text').textContent = `${myRank}ìœ„`;

        const buttons = document.querySelectorAll('#upgrades button');
        items.forEach((item, i) => {
            const price = Math.floor(item.basePrice * Math.pow(1.15, item.owned));
            if(buttons[i]) buttons[i].disabled = gameState.beans < price;
        });

        draw();
        requestAnimationFrame(gameLoop);
    }

    updateStore();
    gameLoop();
</script>
</body>
</html>
